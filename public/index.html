<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ask Mo Anything - Islamic Knowledge AI Assistant">
    <title>Ask Mo Anything</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            overflow-y: scroll;
        }

        :root {
            --primary-color: #1e6f5c;
            --secondary-color: #2a9d8f;
            --background-color: #f8f9fa;
            --text-color: #2c3e50;
            --arabic-font: 'Amiri', serif;
            --english-font: 'Roboto', sans-serif;
            --ramadan-gold: #d4af37;
            --ramadan-deep-blue: #1a365d;
            --ramadan-light-blue: #4a90e2;
            --ramadan-light-gold: rgba(212, 175, 55, 0.1);
        }

        body {
            background: var(--background-color);
            color: var(--text-color);
            font-family: var(--english-font);
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100"><path d="M50 5 L52.5 15 L62.5 15 L54.5 21 L57.5 30 L50 24 L42.5 30 L45.5 21 L37.5 15 L47.5 15 Z" fill="rgba(212,175,55,0.03)" /></svg>');
            background-size: 100px 100px;
            background-repeat: repeat;
        }
        
        /* Ramadan Banner Styles */
        .ramadan-banner {
            background: linear-gradient(135deg, var(--primary-color), #1a4a3c);
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            border-bottom: 2px solid var(--ramadan-gold);
            z-index: 5;
        }
        
        .ramadan-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M50 0 L100 50 L50 100 L0 50 Z" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></svg>');
            background-size: 30px 30px;
            opacity: 0.3;
            z-index: 0;
        }
        
        .ramadan-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            gap: 50px;
            text-align: center;
        }
        
        .ramadan-greeting {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 25px;
            text-align: center;
            max-width: 400px;
        }
        
        .ramadan-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--ramadan-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            background: rgba(30, 111, 92, 0.6);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--ramadan-gold);
        }
        
        .ramadan-greeting h2 {
            font-size: 1.8rem;
            margin: 0;
            background: linear-gradient(to right, #fff, var(--ramadan-gold), #fff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .ramadan-dates {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .eid-countdown {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .countdown-label {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 3px;
            color: var(--ramadan-gold);
        }
        
        .countdown-timer {
            font-weight: 600;
            font-size: 1rem;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .prayer-times-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 18px;
            min-width: 280px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--ramadan-gold);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: rgba(30, 111, 92, 0.2);
        }
        
        .prayer-times-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25);
        }
        
        .prayer-times-header {
            text-align: center;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--ramadan-gold);
            font-size: 1.1rem;
        }
        
        .prayer-times {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }
        
        .prayer-time {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .prayer-name {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .prayer-time-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: white;
        }
        
        .location-info {
            text-align: center;
            font-size: 0.8rem;
            margin-top: 10px;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .ramadan-banner {
                padding: 20px 15px;
            }
            
            .ramadan-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .prayer-times-container {
                width: 100%;
            }
        }

        .related-topics {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .related-topics-header {
            font-size: 1.1em;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            width: fit-content;
        }

        .related-topic-tile {
            align-self: flex-start;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px 20px 12px 45px;
            cursor: pointer;
            transition: all 0.25s ease;
            color: var(--text-color);
            font-size: 0.95em;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: relative;
            text-align: left;
            width: 100%;
            max-width: 600px;
            line-height: 1.4;
            margin: 0;
        }

        .related-topic-tile::before {
            content: '→';
            position: absolute;
            left: 20px;
            color: var(--primary-color);
            font-weight: bold;
            opacity: 0.7;
            font-size: 1.2em;
            transition: all 0.25s ease;
        }

        .related-topic-tile:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .related-topic-tile:hover::before {
            color: white;
            opacity: 1;
            transform: translateX(3px);
        }

        .related-topic-tile:active {
            transform: translateX(8px) scale(0.98);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .arabic-text {
            font-family: var(--arabic-font);
            line-height: 2;
            direction: rtl;
            font-size: 1.1em;
            margin: 10px 0;
            text-align: right;
            background: rgba(30, 111, 92, 0.05);
            padding: 15px;
            border-radius: 8px;
            display: block;
            unicode-bidi: embed;
        }

        .arabic-inline {
            font-family: var(--arabic-font);
            font-size: 1em;
            display: inline-block !important;
            direction: rtl;
            padding: 0;
            margin: 0 0.15em;
            line-height: inherit;
            vertical-align: baseline;
            unicode-bidi: isolate;
        }

        .section-heading {
            color: var(--primary-color);
            font-weight: 500;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header-container {
            width: 100%;
            margin: 0;
            padding: 0;
            background: var(--primary-color);
            position: relative;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Ramadan Hadith Styles */
        .hadith-section {
            width: 100%;
            background: linear-gradient(135deg, #d4af37, #e6c566, #d4af37);
            padding: 30px 0;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
            border-radius: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .ramadan-hadith-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
            color: #333;
        }
        
        .ramadan-hadith-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.12);
        }
        
        .ramadan-hadith-container::before {
            content: '\f658';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: -15px;
            bottom: -15px;
            font-size: 120px;
            color: rgba(212, 175, 55, 0.05);
            z-index: 0;
        }
        
        .hadith-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            color: #333;
        }
        
        .hadith-icon {
            width: 40px;
            height: 40px;
            background: #fff;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .hadith-header h3 {
            color: var(--primary-color);
            font-weight: 600;
            margin: 0;
            font-size: 1.3rem;
        }
        
        .hadith-content {
            padding: 22px;
            background: white;
            border-radius: 12px;
            position: relative;
            z-index: 1;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .hadith-arabic {
            font-family: var(--arabic-font);
            font-size: 1.5rem;
            line-height: 1.8;
            text-align: right;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .hadith-english {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        
        .hadith-source {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }
        
        .refresh-hadith-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            margin-top: 18px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            float: right;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            font-weight: 500;
        }
        
        .refresh-hadith-btn i {
            margin-right: 5px;
        }
        
        .refresh-hadith-btn:hover {
            background: var(--ramadan-gold);
            color: var(--ramadan-deep-blue);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }
        
        @media (max-width: 768px) {
            .hadith-arabic {
                font-size: 1.3rem;
            }
            
            .hadith-english {
                font-size: 1rem;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .header .arabic-title {
                font-size: 1.2em;
            }
            
            .logo-container {
                flex-direction: row;
                gap: 10px;
            }
            
            .header-text {
                align-items: flex-start;
            }
            
            .header-logo {
                width: 50px;
                height: 50px;
            }
            
            .ramadan-hadith-container {
                padding: 0 15px;
            }
        }

        .header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 0;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
        }
        
        .header-logo {
            width: 65px;
            height: 65px;
            /* Removed filter to show logo in its original colors */
            margin-right: 25px;
        }
        
        .header-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, transparent, var(--ramadan-gold), transparent);
            opacity: 0.8;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header .arabic-title {
            font-family: var(--arabic-font);
            font-size: 1.6em;
            margin-top: 5px;
            opacity: 0.9;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .header-image-container {
            max-width: 700px;
            margin: 30px auto;
            position: relative;
        }

        .header-image {
            width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .header-image:hover {
            transform: scale(1.02);
        }

        .image-disclaimer {
            font-size: 0.9em;
            color: #666;
            margin-top: 12px;
            font-style: italic;
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
        }

        .disclaimer {
            background: #fff;
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .disclaimer ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .suggested-topics {
            margin-bottom: 30px;
        }

        .suggested-topics h2 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 500;
            text-align: center;
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 0 auto;
            max-width: 1200px;
        }

        .topic-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .ramadan-card {
            background: linear-gradient(to bottom, #ffffff, #f8f4e5);
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .ramadan-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--ramadan-gold) 0%, var(--ramadan-gold) 50%, transparent 50%);
            opacity: 0.7;
            border-radius: 0 12px 0 12px;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .topic-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .topic-title {
            color: var(--text-color);
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .topic-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .related-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .related-topic-tile {
            background: white;
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            white-space: normal;
            line-height: 1.4;
        }

        .related-topic-tile:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .disclaimer li {
            margin-bottom: 5px;
        }

        .chat-container {
            flex: 1;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            overflow-y: auto;
            min-height: 200px;
            max-height: calc(100vh - 300px);
            display: flex;
            flex-direction: column;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: min-height;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            transition: height 0.3s ease;
        }

        .message {
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 1.1em;
            animation: messageAppear 0.5s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes messageAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .bot-message {
            background-color: #f8f9fa;
            color: var(--text-color);
            align-self: flex-start;
            margin-right: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #eee;
            position: relative;
        }

        .share-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-text {
            font-size: 0.9em;
            color: #1e6f5c;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .share-buttons {
            display: flex;
            gap: 12px;
            margin-top: 5px;
        }

        .share-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .share-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .x-icon {
            font-weight: bold;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }
        
        .x-btn {
            font-weight: bold;
        }

        .share-button:hover {
            background: var(--secondary-color);
        }

        .share-options {
            position: absolute;
            top: 50px;
            right: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 8px 0;
            display: none;
            z-index: 3;
        }

        .share-options.active {
            display: block;
        }

        .share-option {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .share-option:hover {
            background: #f5f5f5;
        }

        .share-option i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        /* Share card styles */
        .share-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            max-width: 600px;
            margin: 20px auto;
            position: relative;
            display: none;
        }

        .share-card.active {
            display: block;
        }

        .share-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .share-card-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .share-card-title {
            font-size: 1.2em;
            font-weight: 500;
            color: var(--primary-color);
        }

        .share-card-content {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .share-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        .share-card-qr {
            width: 80px;
            height: 80px;
        }

        .error-message {
            background-color: #ffebee;
            color: #c62828;
            margin: 10px auto;
            text-align: center;
        }

        .section-header {
            font-weight: bold;
            margin: 15px 0 10px 0;
            color: #1976d2;
            font-size: 1.1em;
        }

        .arabic-text {
            font-family: "Traditional Arabic", "Arabic Typesetting", Arial, sans-serif;
            font-size: 1.3em;
            line-height: 1.8;
            direction: rtl;
            margin: 15px 0;
            text-align: right;
            color: #444;
        }

        .arabic-symbol {
            font-family: "Traditional Arabic", "Arabic Typesetting", Arial, sans-serif;
            font-size: 1.2em;
            color: #444;
            margin: 0 3px;
        }

        .input-container {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            margin-top: auto;
        }

        #user-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            resize: none;
            font-size: 1em;
            font-family: inherit;
            min-height: 45px;
            max-height: 150px;
            transition: all 0.2s ease;
            line-height: 1.4;
            overflow-y: hidden;
        }

        #user-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30,111,92,0.1);
        }

        .send-button {
            padding: 8px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .send-button svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        .send-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .response-indicator {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9em;
            padding: 8px 15px;
            border-radius: 4px;
            display: none;
            text-align: center;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stop-button {
            display: none;
            padding: 8px;
            background: #dc3545;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            margin-left: 8px;
            width: 40px;
            height: 40px;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .stop-button svg {
            width: 16px;
            height: 16px;
            stroke: white;
        }

        .stop-button:hover {
            background: #c82333;
        }

        .thinking-message {
            text-align: center;
            padding: 10px;
        }

        .thinking-message .arabic-text {
            font-family: "Traditional Arabic", "Arabic Typesetting", Arial, sans-serif;
            font-size: 1.4em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .thinking-message .english-text {
            color: #666;
            margin-bottom: 10px;
        }

        .thinking-message .loading-dots {
            display: flex;
            justify-content: center;
            gap: 4px;
        }

        .thinking-message .loading-dots span {
            font-size: 24px;
            line-height: 10px;
            color: var(--primary-color);
            opacity: 0.2;
            transition: opacity 0.3s ease;
        }

        @media (max-width: 1200px) {
            .topic-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .topic-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .chat-container {
                padding: 10px;
            }

            .message {
                max-width: 90%;
            }

            .input-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header-container">
        <div class="header">
            <div class="logo-container">
                <img src="/images/ask-mo-logo.png" alt="Ask Mo Anything Logo" class="header-logo">
                <div class="header-text">
                    <h1>Ask Mo Anything</h1>
                    <div class="arabic-title">اسأل عن النبي محمد ﷺ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ramadan Banner -->
    <div class="ramadan-banner">
        <div class="ramadan-content">
            <div class="ramadan-greeting">
                <div class="ramadan-icon">☪️</div>
                <h2>Ramadan Mubarak!</h2>
                <div class="ramadan-dates">March 1 - March 29, 2025</div>
                <div class="eid-countdown">
                    <div class="countdown-label">Eid Al-Fitr Countdown:</div>
                    <div class="countdown-timer" id="eid-countdown">Loading...</div>
                </div>
            </div>
            <div class="prayer-times-container">
                <div class="prayer-times-header">Today's Fasting Times</div>
                <div class="prayer-times">
                    <div class="prayer-time">
                        <span class="prayer-name">Suhoor Ends</span>
                        <span class="prayer-time-value" id="suhoor-time">Loading...</span>
                    </div>
                    <div class="prayer-time">
                        <span class="prayer-name">Iftar</span>
                        <span class="prayer-time-value" id="iftar-time">Loading...</span>
                    </div>
                </div>
                <div class="location-info" id="location-info">Based on your location</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header-image-container">
            <img src="/images/islamic-art.png" alt="Islamic Art - Artistic Illustration" class="header-image">
            <p class="image-disclaimer">Note: This is an artistic illustration and not a depiction of Prophet Muhammad (peace be upon him)</p>
        </div>
        
        <!-- Ramadan Daily Hadith -->
        <div class="hadith-section">
            <div class="ramadan-hadith-container">
                <div class="hadith-header">
                    <div class="hadith-icon"><i class="fas fa-book-open"></i></div>
                    <h3>Hadith of the Day</h3>
                </div>
                <div class="hadith-content" id="daily-hadith">
                    <div class="hadith-arabic" lang="ar">مَنْ صَامَ رَمَضَانَ إِيمَانًا وَاحْتِسَابًا غُفِرَ لَهُ مَا تَقَدَّمَ مِنْ ذَنْبِهِ</div>
                    <div class="hadith-english">"Whoever fasts during Ramadan out of sincere faith and hoping to attain Allah's rewards, then all his past sins will be forgiven."</div>
                    <div class="hadith-source">Sahih al-Bukhari 2014</div>
                </div>
                <button class="refresh-hadith-btn" id="refresh-hadith-btn"><i class="fas fa-sync-alt"></i> New Hadith</button>
            </div>
        </div>



        <div class="suggested-topics">
            <h2>Ramadan Special Topics</h2>
            <div class="topic-grid">
                <!-- Ramadan-specific Topics -->
                <div class="topic-card ramadan-card" data-topic="What is the significance of Ramadan in Islam?">
                    <div class="topic-icon">🌙</div>
                    <div class="topic-title">Significance of Ramadan</div>
                    <div class="topic-description">Learn about the holy month and its importance in Islam</div>
                </div>
                <div class="topic-card ramadan-card" data-topic="What are the best practices during Ramadan?">
                    <div class="topic-icon">✨</div>
                    <div class="topic-title">Ramadan Best Practices</div>
                    <div class="topic-description">Discover recommended acts of worship during the holy month</div>
                </div>
                <div class="topic-card ramadan-card" data-topic="What are the rules of fasting in Ramadan and who is exempt?">
                    <div class="topic-icon">🍽️</div>
                    <div class="topic-title">Fasting Guidelines</div>
                    <div class="topic-description">Learn about fasting rules, exemptions, and making up missed fasts</div>
                </div>
                <div class="topic-card ramadan-card" data-topic="What is Laylatul Qadr and how should we observe it?">
                    <div class="topic-icon">⭐</div>
                    <div class="topic-title">Laylatul Qadr</div>
                    <div class="topic-description">Understand the Night of Power and its special significance</div>
                </div>
            </div>
            
            <h2 style="margin-top: 30px;">Explore Islamic Knowledge</h2>
            <div class="topic-grid">
                <!-- Original Topic Cards -->
                <div class="topic-card" data-topic="Tell me about the life and teachings of Prophet Muhammad ﷺ">
                    <div class="topic-icon">📚</div>
                    <div class="topic-title">Prophetic Biography</div>
                    <div class="topic-description">Discover the life and teachings of Prophet Muhammad ﷺ</div>
                </div>
                <div class="topic-card" data-topic="What does the Quran teach us about morals and ethics?">
                    <div class="topic-icon">❤️</div>
                    <div class="topic-title">Islamic Ethics</div>
                    <div class="topic-description">Explore Islamic morals, values, and character building</div>
                </div>
                <div class="topic-card" data-topic="What are the five pillars of Islam?">
                    <div class="topic-icon">🕌</div>
                    <div class="topic-title">Five Pillars of Islam</div>
                    <div class="topic-description">Learn about the fundamental practices of the Islamic faith</div>
                </div>
                <div class="topic-card" data-topic="How did the Prophet Muhammad ﷺ treat people of other faiths?">
                    <div class="topic-icon">🤝</div>
                    <div class="topic-title">Interfaith Relations</div>
                    <div class="topic-description">Explore the Prophet's approach to people of different beliefs</div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    <div lang="ar">السَّلاَمُ عَلَيْكُمْ وَرَحْمَةُ اللهِ وَبَرَكَاتُهُ</div>
                    Welcome! I'm here to help answer your questions about Prophet Muhammad ﷺ and Islamic teachings. What would you like to know?
                </div>
            </div>
            <div class="input-section">
                <div class="response-indicator" style="display: none;">Mo is responding...</div>
                <div class="input-container">
                    <textarea id="user-input" placeholder="Type your question here..." rows="1"></textarea>
                    <button id="send-button" class="send-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                    <button id="stop-button" onclick="stopGeneration()" class="stop-button" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="6" y="6" width="12" height="12" rx="1" ry="1"></rect>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <strong>Important Notice:</strong>
            <p>This AI assistant provides information about Prophet Muhammad ﷺ and Islamic teachings based on authentic sources. Please note:</p>
            <ul>
                <li>This is an AI tool and should not be considered a replacement for proper Islamic scholarship</li>
                <li>For religious rulings (fatawa), please consult qualified Islamic scholars</li>
                <li>Verify all information with authentic Islamic sources</li>
                <li>Treat all religious content with proper respect and adab (etiquette)</li>
            </ul>
        </div>

        <div class="empowering-section">
            <h2>Empowering Islamic Knowledge Through Technology</h2>
            <p>To ensure continuous and reliable access to this service, we encourage using your own OpenAI API key. This gives you unlimited access and helps support the infrastructure that makes this knowledge accessible to everyone.</p>
            <p>You can get your API key at <a href="https://platform.openai.com" target="_blank">OpenAI's website</a>, or to support our development efforts and continue accessing this platform:</p>
            <div class="buy-coffee-container">
                <a href="https://buymeacoffee.com/samir.shah" target="_blank" class="buy-coffee-button">
                    <img src="https://cdn.buymeacoffee.com/buttons/v2/default-white.png" alt="Buy Me A Coffee">
                </a>
            </div>
        </div>

        <div class="about-section">
            <h2><span class="bismillah">بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيْمِ</span></h2>
            <h3>About Ask Mo Anything</h3>
            <p>Ask Mo Anything was built by Muslims, for Muslims, with the intention of serving our Ummah. In a world where accessing reliable Islamic knowledge can be challenging, we aim to bridge the gap between traditional wisdom and modern technology.</p>
            <p>Our goal is to make the teachings of Prophet Muhammad ﷺ more accessible while maintaining the highest standards of authenticity and scholarly respect. We believe that technology, when used mindfully, can help revive Islamic scholarship in our modern era.</p>
            
            <div class="authenticity-section">
                <h4>Our Commitment to Authenticity</h4>
                <ul>
                    <li>✓ This AI assistant is trained on authentic Islamic sources including recognized translations of the Quran, verified Hadith collections, and respected scholarly works.</li>
                    <li>✓ While we strive for accuracy, this tool is not a substitute for qualified Islamic scholars or official religious rulings (fatwas).</li>
                    <li>✓ For critical matters of faith, worship, or Islamic law, please consult qualified scholars and verify information with authentic sources.</li>
                    <li>✓ Our responses are generated through AI interpretation of Islamic texts - always cross-reference with original sources.</li>
                </ul>
            </div>
        </div>
    </div>

    <style>
        .empowering-section {
            text-align: center;
            padding: 40px 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 15px;
            margin: 40px 0;
        }

        .empowering-section h2 {
            margin-bottom: 20px;
            font-size: 2em;
        }

        .empowering-section p {
            margin-bottom: 15px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .empowering-section a {
            color: white;
            text-decoration: underline;
        }

        .buy-coffee-container {
            margin-top: 30px;
        }

        .buy-coffee-button img {
            height: 40px;
        }

        .about-section {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            margin: 40px 0;
        }

        .about-section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .about-section h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .bismillah {
            font-family: var(--arabic-font);
            font-size: 1.5em;
            color: var(--primary-color);
            display: block;
            text-align: center;
            margin-bottom: 20px;
        }

        .authenticity-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .authenticity-section h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .authenticity-section ul {
            list-style: none;
            padding: 0;
        }

        .authenticity-section li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
    </style>

    <script>
        // Global variables
        let chatMessages;
        let userInput;
        let sendButton;

        // Sharing functions
        function showShareOptions(message) {
            const options = message.querySelector('.share-options');
            options.classList.toggle('active');
        }

        function generateShareCard(message) {
            const content = message.textContent;
            const card = document.createElement('div');
            card.className = 'share-card';
            card.innerHTML = `
                <div class="share-card-header">
                    <img src="/images/islamic-art.png" class="share-card-logo" alt="Ask Mo Logo">
                    <div class="share-card-title">Ask Mo Anything</div>
                </div>
                <div class="share-card-content">${content}</div>
                <div class="share-card-footer">
                    <div>ask-mo-anything.vercel.app</div>
                    <div class="share-card-qr"></div>
                </div>
            `;
            
            // Generate QR code
            new QRCode(card.querySelector('.share-card-qr'), {
                text: 'https://ask-mo-anything.vercel.app',
                width: 80,
                height: 80
            });

            return card;
        }

        async function shareToTwitter(message) {
            const text = encodeURIComponent(message.textContent.substring(0, 280));
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent('https://ask-mo-anything.vercel.app')}`);
        }

        async function shareToWhatsApp(message) {
            const text = encodeURIComponent(message.completeResponse || message.fullResponse || message.rawResponse || message.textContent);
            window.open(`https://wa.me/?text=${text}%20-%20via%20https://ask-mo-anything.vercel.app`);
        }

        async function shareToTelegram(message) {
            const text = encodeURIComponent(message.completeResponse || message.fullResponse || message.rawResponse || message.textContent);
            window.open(`https://t.me/share/url?url=${encodeURIComponent('https://ask-mo-anything.vercel.app')}&text=${text}`);
        }

        async function copyToClipboard(message) {
            try {
                await navigator.clipboard.writeText(message.completeResponse || message.fullResponse || message.rawResponse || message.textContent);
                alert('Content copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }
        
        // Process message text
        function processMessageText(text) {
            if (!text) return '';
            
            let processedText = text;
            let relatedTopicsHtml = '';
            
            // Extract and process related topics
            const topicsMatch = processedText.match(/\[RELATED TOPICS\]([\s\S]*?)(?=\[|$)/i);
            if (topicsMatch) {
                const topicsSection = topicsMatch[1];
                processedText = processedText.replace(topicsMatch[0], '');
                
                // Split into lines and collect all questions
                const topics = [];
                const lines = topicsSection.split('\n');
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Handle numbered questions and their continuations
                    if (line.match(/^\d+\./)) {
                        let fullQuestion = line;
                        while (i + 1 < lines.length && !lines[i + 1].trim().match(/^\d+\.\s*|\[/)) {
                            i++;
                            fullQuestion += ' ' + lines[i].trim();
                        }
                        topics.push(fullQuestion.replace(/^\d+\.\s*/, ''));
                    }
                    // Handle standalone questions
                    else if (line.match(/^(What|How|Why|When|Where|Who|Which|Did|Is|Are|Can|Could|Should|Would|Tell)/i)) {
                        topics.push(line);
                    }
                }

                // Create quick-reply buttons for topics
                if (topics.length > 0) {
                    relatedTopicsHtml = `<div class="related-topics">
                        <div class="related-topics-header">Related Questions:</div>
                        ${topics.map(topic => {
                            // Clean up the topic text and add RTL marks
                            const clean = topic
                                .replace(/ﷺ/g, '(PBUH)\u200F')
                                .replace(/(رضي الله عنه|رضي الله عنها)/g, '(RA)\u200F')
                                .replace(/\s+/g, ' ')
                                .trim();
                            
                            // Create quick-reply button
                            const escapedTopic = clean.replace(/["']/g, '\\$&');
                            return `<button class="related-topic-tile" onclick="selectTopic('${escapedTopic}')">${clean}</button>`;
                        }).join('')}
                    </div>`;
                }
            }

            // Add empty Arabic character for alignment
            const arblank = '&#1564;';
            
            // Process the main text
            processedText = processedText
                // Handle sections
                .replace(/\[(CONCLUSION|HADITH|SCHOLARLY OPINIONS|PRACTICAL GUIDANCE)\]([^\[]*)/gi, 
                    '<div class="section-heading">[$1]</div>$2')
                // Handle honorifics inline with proper spacing and RTL marks
                .replace(/(ﷺ|رضي الله عنه|رضي الله عنها)/g, 
                    match => ` ${arblank}<span class="arabic-inline" style="display:inline" lang="ar">${match}</span>\u200F `)
                // Handle longer Arabic passages (excluding honorifics)
                .replace(/(?<!ﷺ|رضي الله عنه|رضي الله عنها)([\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u064B-\u0652][^\s]*(?:\s+[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u064B-\u0652][^\s]*){2,})/g, 
                    (_, match) => `<div class="arabic-text" lang="ar">${match}</div>`)
                // Handle remaining single Arabic words (excluding honorifics)
                .replace(/(?<!ﷺ|رضي الله عنه|رضي الله عنها)([\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\u064B-\u0652]+)/g, 
                    (_, match) => `<span class="arabic-inline" lang="ar">${match}</span>`)
                // Clean up any double spaces
                .replace(/\s+/g, ' ');
            
            // Add related topics back at the end
            return processedText + relatedTopicsHtml;
        }
        
        // Helper functions
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function appendErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'message error-message';
            errorDiv.textContent = message;
            chatMessages.appendChild(errorDiv);
            scrollToBottom();
        }
        
        // Initialize after DOM is loaded
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        document.addEventListener('DOMContentLoaded', () => {
            chatMessages = document.getElementById('chat-messages');
            userInput = document.getElementById('user-input');
            sendButton = document.getElementById('send-button');

            // Handle Enter key
            // Auto-resize textarea on input
            userInput.addEventListener('input', function() {
                autoResizeTextarea(this);
            });

            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && !isGenerating) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Handle button click
            sendButton.addEventListener('click', function() {
                if (!isGenerating) {
                    sendMessage();
                }
            });

            // Handle topic card clicks
            document.querySelectorAll('.topic-card').forEach(card => {
                card.addEventListener('click', function() {
                    const topic = this.getAttribute('data-topic');
                    if (topic) {
                        userInput.value = topic;
                        sendMessage();
                    }
                });
            });
        });

        function selectTopic(topic) {
            // Handle escaped quotes in the topic
            const unescapedTopic = topic
                .replace(/\\'/g, "'")
                .replace(/\\\"/g, '"');
            userInput.value = unescapedTopic;
            sendMessage(unescapedTopic);
        }

        let currentReader = null;
        let isGenerating = false;

        function stopGeneration() {
            if (currentReader) {
                currentReader.cancel();
                document.getElementById('stop-button').style.display = 'none';
                document.querySelector('.send-button').style.display = 'inline-flex';
                isGenerating = false;
            }
        }

        async function sendMessage(message) {
            if (isGenerating) return;

            // If no message provided, get it from the input
            if (!message) message = userInput.value;
            if (!message || !message.trim()) return;
            
            // Clear input and show user message
            userInput.value = '';
            document.querySelector('.response-indicator').style.display = 'block';
            document.querySelector('.send-button').style.display = 'none';
            document.getElementById('stop-button').style.display = 'inline-flex';
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.textContent = message;
            chatMessages.appendChild(userMessage);
            scrollToBottom();

            // Show thinking message with Islamic theme
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'message bot-message';
            loadingMessage.innerHTML = `
                <div class="thinking-message">
                    <div class="english-text">Mo is responding...</div>
                    <div class="loading-dots"><span>.</span><span>.</span><span>.</span></div>
                </div>
            `;
            chatMessages.appendChild(loadingMessage);
            scrollToBottom();

            // Add loading animation
            const dots = loadingMessage.querySelectorAll('.loading-dots span');
            let dotIndex = 0;
            const loadingInterval = setInterval(() => {
                dots.forEach(dot => dot.style.opacity = '0.2');
                dots[dotIndex].style.opacity = '1';
                dotIndex = (dotIndex + 1) % dots.length;
            }, 500);

            let currentMessage = document.createElement('div');
            currentMessage.className = 'message bot-message';
            currentMessage.fullResponse = '';  // Track full response text
            currentMessage.rawResponse = '';   // Track raw response before processing
            
            // Initialize or get the global completeResponse variable
            if (typeof window.completeResponse === 'undefined') {
                window.completeResponse = '';
            } else {
                // Clear previous response when starting a new one
                window.completeResponse = '';
            }
            
            let currentSection = '';
            
            try {
                isGenerating = true;
                document.querySelector('.send-button').style.display = 'none';
                document.getElementById('stop-button').style.display = 'inline-flex';

                console.log('Sending message:', message);
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });

                if (!response.ok) {
                    if (response.status === 429) {
                        const errorData = await response.json();
                        loadingMessage.remove();
                        const limitMessage = document.createElement('div');
                        limitMessage.className = 'message bot-message';
                        limitMessage.innerHTML = `
                            <div class="empowering-section" style="margin: 0; text-align: left;">
                                <h3 style="color: var(--primary-color); margin-bottom: 15px;">You've reached our API limit for today.</h3>
                                <p>To continue using our platform immediately:</p>
                                <ol style="margin: 15px 0; padding-left: 20px;">
                                    <li>Get your own OpenAI API key (preferred) - this gives you unlimited access right away</li>
                                </ol>
                                <p style="margin: 15px 0;">Want to support our mission? Consider buying us a coffee! 🙂</p>
                                <p>Your support helps us develop new features including:</p>
                                <ul style="margin: 10px 0 15px 20px; list-style-type: '- ';">
                                    <li>User accounts with saved conversations</li>
                                    <li>Premium membership with unlimited questions</li>
                                    <li>Advanced features for deeper Islamic learning</li>
                                </ul>
                                <p style="font-style: italic; font-size: 0.9em;">Note: Supporting through Buy Me a Coffee is currently just for development support. We're working on a proper membership system!</p>
                                <div class="buy-coffee-container" style="margin-top: 15px; text-align: center;">
                                    <a href="https://buymeacoffee.com/samir.shah" target="_blank" class="buy-coffee-button">
                                        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-white.png" alt="Buy Me A Coffee">
                                    </a>
                                </div>
                            </div>
                        `;
                        chatMessages.appendChild(limitMessage);
                        scrollToBottom();
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Remove loading message
                loadingMessage.remove();

                // Show stop button and hide send button
                document.getElementById('stop-button').style.display = 'inline-flex';
                document.querySelector('.send-button').style.display = 'none';
                isGenerating = true;

                currentReader = response.body.getReader();
                const decoder = new TextDecoder();
                let responseComplete = false;
                let timeoutId;
                let lastChunkTime = Date.now();

                console.log('Starting stream processing');
                const resetTimeout = () => {
                    if (timeoutId) clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => {
                        if (!responseComplete) {
                            console.error('Client timeout - no response for 60 seconds');
                            appendErrorMessage("The response was incomplete. Please try asking your question again.");
                            currentReader.cancel();
                        }
                    }, 60000);
                };

                while (true) {
                    resetTimeout();
                    const { done, value } = await currentReader.read();

                    if (done) {
                        console.log('Stream complete');
                        clearTimeout(timeoutId);
                        document.getElementById('stop-button').style.display = 'none';
                        document.querySelector('.send-button').style.display = 'inline-flex';
                        isGenerating = false;
                        break;
                    }

                    const timeSinceLastChunk = Date.now() - lastChunkTime;
                    if (timeSinceLastChunk > 10000) {
                        console.log(`No chunks received for ${timeSinceLastChunk}ms`);
                    }

                    lastChunkTime = Date.now();
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.trim() === '') continue;

                        const message = line.replace(/^data: /, '');
                        if (message === '[DONE]') {
                            console.log('Received [DONE] message');
                            responseComplete = true;
                            clearTimeout(timeoutId);
                            break;
                        }

                        try {
                            const parsed = JSON.parse(message);
                            if (parsed.error) {
                                console.error('Received error:', parsed.error);
                                appendErrorMessage(parsed.error);
                                clearTimeout(timeoutId);
                                return;
                            }
                            if (parsed.status === 'complete') {
                                console.log('Received complete status');
                                responseComplete = true;
                                clearTimeout(timeoutId);
                                break;
                            }
                            if (parsed.chunk) {
                                const chunk = parsed.chunk.trim();
                                
                                // Check for new section
                                const sectionMatch = chunk.match(/^\[(.*?)\]/);
                                if (sectionMatch) {
                                    const sectionName = sectionMatch[1];
                                    
                                    // If it's a RELATED TOPICS section
                                    if (sectionName === 'RELATED TOPICS') {
                                        // Only create new message and topics container if we don't already have one
                                        if (currentSection !== 'RELATED TOPICS') {
                                            // Append any existing message
                                            if (currentMessage && currentMessage.innerHTML.trim()) {
                                                chatMessages.appendChild(currentMessage);
                                            }
                                            // Create a new message for topics
                                            currentMessage = document.createElement('div');
                                            currentMessage.className = 'message bot-message';
                                            currentSection = 'RELATED TOPICS';
                                            
                                            // Create topics container
                                            const topicsDiv = document.createElement('div');
                                            topicsDiv.className = 'related-topics';
                                            const header = document.createElement('div');
                                            header.className = 'related-topics-header';
                                            header.textContent = 'Related Topics:';
                                            topicsDiv.appendChild(header);
                                            currentMessage.appendChild(topicsDiv);
                                            chatMessages.appendChild(currentMessage);
                                            
                                            // Add related topics header to complete response
                                            window.completeResponse += '\n\nRelated Topics:\n';
                                        }
                                    } else {
                                        // For other sections
                                        if (currentMessage && currentMessage.innerHTML.trim()) {
                                            chatMessages.appendChild(currentMessage);
                                            requestAnimationFrame(scrollToBottom);
                                        }
                                        currentMessage = document.createElement('div');
                                        currentMessage.className = 'message bot-message';
                                        currentSection = sectionName;
                                        const header = document.createElement('div');
                                        header.className = 'section-header';
                                        header.textContent = chunk;
                                        currentMessage.appendChild(header);
                                        
                                        // Add section header to complete response
                                        window.completeResponse += '\n\n' + chunk + '\n';
                                    }
                                } else {
                                    // Handle non-section content
                                    if (currentSection === 'RELATED TOPICS') {
                                        const topicsDiv = currentMessage.querySelector('.related-topics');
                                        if (topicsDiv) {
                                            // Initialize buffers if needed
                                            if (!topicsDiv.currentTopic) {
                                                topicsDiv.currentTopic = '';
                                                topicsDiv.honorificPending = false;
                                            }
                                            
                                            // Handle honorifics or normal text
                                            let processedChunk = chunk;
                                            if (chunk.includes('ﷺ')) {  // Prophet Muhammad (PBUH)
                                                processedChunk = processedChunk.replace(/ﷺ/g, ' (PBUH) ');
                                                topicsDiv.honorificPending = true;
                                            } else if (chunk.includes('رضي الله عنه') || chunk.includes('رضي الله عنها')) {  // RA
                                                processedChunk = processedChunk.replace(/رضي الله عنه|رضي الله عنها/g, ' (RA) ');
                                                topicsDiv.honorificPending = true;
                                            } else if (chunk.includes('عليه السلام')) {  // AS
                                                processedChunk = processedChunk.replace(/عليه السلام/g, ' (AS) ');
                                                topicsDiv.honorificPending = true;
                                            }
                                            
                                            if (topicsDiv.honorificPending && !processedChunk.trim().match(/[(.)]$/)) {
                                                topicsDiv.currentTopic += processedChunk + ' ';
                                                topicsDiv.honorificPending = false;
                                            } else {
                                                topicsDiv.currentTopic += processedChunk;
                                            }
                                            
                                            // Check if we have any complete questions
                                            const questionMatches = topicsDiv.currentTopic.match(/\d+\.[^?]*\?/g);
                                            if (questionMatches && !topicsDiv.honorificPending) {
                                                for (const question of questionMatches) {
                                                    // Clean up the question text
                                                    const cleanQuestion = question
                                                        .replace(/^\d+\.\s*/, '')  // Remove leading numbers
                                                        .replace(/\s+/g, ' ')       // Normalize whitespace
                                                        .trim();
                                                    
                                                    // Create button for the question
                                                    const button = document.createElement('button');
                                                    button.className = 'related-topic-tile';
                                                    button.textContent = cleanQuestion;
                                                    button.onclick = () => selectTopic(cleanQuestion);
                                                    topicsDiv.appendChild(button);
                                                }
                                                
                                                // Keep any remaining partial question
                                                const lastQuestionEnd = topicsDiv.currentTopic.lastIndexOf('?') + 1;
                                                topicsDiv.currentTopic = topicsDiv.currentTopic.substring(lastQuestionEnd);
                                            }
                                        }
                                    } else {
                                        // Regular content
                                        if (!currentMessage) {
                                            currentMessage = document.createElement('div');
                                            currentMessage.className = 'message bot-message';
                                        }
                                        const content = document.createElement('span');
                                        content.innerHTML = processMessageText(chunk);
                                        currentMessage.appendChild(content);
                                        // Accumulate raw response text
                                        currentMessage.rawResponse = (currentMessage.rawResponse || '') + chunk;
                                        // Keep same text for full response
                                        currentMessage.fullResponse = (currentMessage.fullResponse || '') + chunk;
                                        // Add to global complete response
                                        window.completeResponse += chunk;
                                        if (!currentMessage.parentNode) {
                                            chatMessages.appendChild(currentMessage);
                                        }
                                    }
                                }
                                scrollToBottom();
                            }
                        } catch (e) {
                            console.error("Error parsing message:", e, message);
                        }
                    }
                }
            } catch (error) {
                console.error('Error in sendMessage:', error);
                appendErrorMessage("An error occurred. Please try again.");
            } finally {
                isGenerating = false;
                document.querySelector('.send-button').style.display = 'inline-flex';
                document.getElementById('stop-button').style.display = 'none';
                document.querySelector('.response-indicator').style.display = 'none';
                if (loadingInterval) {
                    clearInterval(loadingInterval);
                }

                // Create a complete response container with all accumulated text
                const completeResponseContainer = document.createElement('div');
                completeResponseContainer.className = 'message bot-message complete-response-container';
                completeResponseContainer.style.marginTop = '20px';
                completeResponseContainer.style.backgroundColor = '#f0f7f4';
                completeResponseContainer.style.border = '1px solid #c8e6d7';
                completeResponseContainer.style.borderRadius = '8px';
                completeResponseContainer.style.padding = '15px';
                completeResponseContainer.style.marginTop = '20px';
                completeResponseContainer.style.boxShadow = '0 2px 5px rgba(0,0,0,0.05)';
                
                // Store the complete response text from the global variable
                completeResponseContainer.fullResponse = window.completeResponse;
                
                // Add a small indicator that this is for sharing
                const shareIndicator = document.createElement('div');
                shareIndicator.style.fontSize = '0.9em';
                shareIndicator.style.color = '#1e6f5c';
                shareIndicator.style.marginBottom = '10px';
                shareIndicator.style.fontWeight = '500';
                shareIndicator.textContent = 'Found this helpful? Spread the knowledge!';
                completeResponseContainer.appendChild(shareIndicator);
                
                // Add share section to the complete response container
                const shareSection = document.createElement('div');
                shareSection.className = 'share-section';
                shareSection.innerHTML = `
                    <div class="share-text">Continue the conversation:</div>
                    <div class="share-buttons">
                        <button class="share-btn x-btn" onclick="shareToTwitter(this.closest('.complete-response-container'))" title="Share on X">
                            <span class="x-icon">𝕏</span>
                        </button>
                        <button class="share-btn" onclick="shareToWhatsApp(this.closest('.complete-response-container'))" title="Share on WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn" onclick="shareToTelegram(this.closest('.complete-response-container'))" title="Share on Telegram">
                            <i class="fab fa-telegram"></i>
                        </button>
                        <button class="share-btn" onclick="copyToClipboard(this.closest('.complete-response-container'))" title="Copy to clipboard">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                `;
                completeResponseContainer.appendChild(shareSection);
                chatMessages.appendChild(completeResponseContainer);
            }
        }

        function scrollToBottom() {
            const container = document.querySelector('.chat-container');
            const totalHeight = chatMessages.scrollHeight + 40; // 40px for padding
            const maxHeight = window.innerHeight - 300;
            
            // Set container height based on content
            container.style.minHeight = Math.min(totalHeight, maxHeight) + 'px';
            
            // Only scroll the chat messages container
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 10);
        }

        function appendErrorMessage(message) {
            const errorMessage = document.createElement('div');
            errorMessage.className = 'message error-message';
            errorMessage.textContent = message;
            chatMessages.appendChild(errorMessage);
            scrollToBottom();
        }

    </script>
    
    <!-- Ramadan Prayer Times & Hadith Script -->
    <script>
        // Ramadan Hadiths Collection
        const ramadanHadiths = [
            {
                arabic: "مَنْ صَامَ رَمَضَانَ إِيمَانًا وَاحْتِسَابًا غُفِرَ لَهُ مَا تَقَدَّمَ مِنْ ذَنْبِهِ",
                english: "Whoever fasts during Ramadan out of sincere faith and hoping to attain Allah's rewards, then all his past sins will be forgiven.",
                source: "Sahih al-Bukhari 2014"
            },
            {
                arabic: "الصِّيَامُ جُنَّةٌ فَلاَ يَرْفُثْ وَلاَ يَجْهَلْ، وَإِنِ امْرُؤٌ قَاتَلَهُ أَوْ شَاتَمَهُ فَلْيَقُلْ إِنِّي صَائِمٌ، إِنِّي صَائِمٌ",
                english: "Fasting is a shield. So, the person observing fasting should avoid sexual relation with his wife and should not behave foolishly and impudently, and if somebody fights with him or abuses him, he should tell him twice, 'I am fasting.'",
                source: "Sahih al-Bukhari 1894"
            },
            {
                arabic: "إِذَا جَاءَ رَمَضَانُ فُتِحَتْ أَبْوَابُ الْجَنَّةِ، وَغُلِّقَتْ أَبْوَابُ النَّارِ، وَصُفِّدَتِ الشَّيَاطِينُ",
                english: "When the month of Ramadan starts, the gates of heaven are opened and the gates of Hell are closed and the devils are chained.",
                source: "Sahih al-Bukhari 1899"
            },
            {
                arabic: "مَنْ قَامَ رَمَضَانَ إِيمَانًا وَاحْتِسَابًا غُفِرَ لَهُ مَا تَقَدَّمَ مِنْ ذَنْبِهِ",
                english: "Whoever establishes prayers during the nights of Ramadan faithfully out of sincere faith and hoping to attain Allah's rewards, all his past sins will be forgiven.",
                source: "Sahih al-Bukhari 2008"
            },
            {
                arabic: "مَنْ أَفْطَرَ صَائِمًا، كَانَ لَهُ مِثْلُ أَجْرِهِ، غَيْرَ أَنَّهُ لاَ يَنْقُصُ مِنْ أَجْرِ الصَّائِمِ شَيْئًا",
                english: "Whoever provides food for breaking the fast of a fasting person receives the same reward as the one who was fasting, without decreasing the reward of the fasting person.",
                source: "Sunan al-Tirmidhi 807"
            },
            {
                arabic: "إِنَّ فِي الْجَنَّةِ بَابًا يُقَالُ لَهُ الرَّيَّانُ يَدْخُلُ مِنْهُ الصَّائِمُونَ يَوْمَ الْقِيَامَةِ لاَ يَدْخُلُ مِنْهُ أَحَدٌ غَيْرُهُمْ",
                english: "There is a gate in Paradise called Ar-Raiyan, through which those who observe fasting will enter on the Day of Resurrection, and none except them will enter through it.",
                source: "Sahih al-Bukhari 1896"
            },
            {
                arabic: "اَلصَّوْمُ لِي وَأَنَا أَجْزِي بِهِ",
                english: "Allah says: 'Fasting is for Me and I will give the reward for it.'",
                source: "Sahih al-Bukhari 1904"
            }
        ];
        
        // Function to display a random hadith
        function displayRandomHadith() {
            const randomIndex = Math.floor(Math.random() * ramadanHadiths.length);
            const hadith = ramadanHadiths[randomIndex];
            
            document.querySelector('.hadith-arabic').textContent = hadith.arabic;
            document.querySelector('.hadith-english').textContent = hadith.english;
            document.querySelector('.hadith-source').textContent = hadith.source;
        }
        
        // Function to get user's location and fetch prayer times
        async function getPrayerTimes() {
            try {
                // First try to get user's location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Get location name using reverse geocoding
                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                            const data = await response.json();
                            const city = data.address.city || data.address.town || data.address.village || 'your location';
                            document.getElementById('location-info').textContent = `Based on ${city}`;
                        } catch (error) {
                            console.error('Error getting location name:', error);
                        }
                        
                        // Fetch prayer times using coordinates
                        fetchPrayerTimes(lat, lng);
                    }, (error) => {
                        console.error('Error getting location:', error);
                        // Fallback to default location (Washington DC)
                        fetchPrayerTimes(38.9072, -77.0369);
                        document.getElementById('location-info').textContent = 'Based on Washington DC (default)';
                    });
                } else {
                    // Geolocation not supported
                    fetchPrayerTimes(38.9072, -77.0369); // Default to Washington DC
                    document.getElementById('location-info').textContent = 'Based on Washington DC (default)';
                }
            } catch (error) {
                console.error('Error in getPrayerTimes:', error);
            }
        }
        
        // Function to fetch prayer times from API
        async function fetchPrayerTimes(latitude, longitude) {
            try {
                const today = new Date();
                const date = today.getDate();
                const month = today.getMonth() + 1;
                const year = today.getFullYear();
                
                // Using AlAdhan API to get prayer times
                const url = `https://api.aladhan.com/v1/timings/${date}-${month}-${year}?latitude=${latitude}&longitude=${longitude}&method=2`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    // Set Suhoor time (Fajr time)
                    const fajrTime = data.data.timings.Fajr;
                    document.getElementById('suhoor-time').textContent = formatTime(fajrTime);
                    
                    // Set Iftar time (Maghrib time)
                    const maghribTime = data.data.timings.Maghrib;
                    document.getElementById('iftar-time').textContent = formatTime(maghribTime);
                }
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                document.getElementById('suhoor-time').textContent = 'Error loading';
                document.getElementById('iftar-time').textContent = 'Error loading';
            }
        }
        
        // Function to format time from 24h to 12h format
        function formatTime(time24) {
            const [hours, minutes] = time24.split(':');
            let period = 'AM';
            let hour = parseInt(hours, 10);
            
            if (hour >= 12) {
                period = 'PM';
                if (hour > 12) hour -= 12;
            }
            if (hour === 0) hour = 12;
            
            return `${hour}:${minutes} ${period}`;
        }
        
        // Function to update Eid countdown timer
        function updateEidCountdown() {
            // Eid al-Fitr 2025 date (March 30, 2025)
            const eidDate = new Date('March 30, 2025 00:00:00').getTime();
            const now = new Date().getTime();
            const distance = eidDate - now;
            
            // Calculate days, hours, minutes and seconds
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            
            // Display the result
            const countdownElement = document.getElementById('eid-countdown');
            
            if (distance < 0) {
                countdownElement.innerHTML = 'Eid Mubarak! 🎉';
            } else {
                countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m`;
            }
        }
        
        // Initialize prayer times and countdown on page load
        document.addEventListener('DOMContentLoaded', () => {
            getPrayerTimes();
            updateEidCountdown();
            // Update countdown every minute
            setInterval(updateEidCountdown, 60000);
            
            // Set up hadith refresh button
            document.getElementById('refresh-hadith-btn').addEventListener('click', displayRandomHadith);
            // Display initial random hadith
            displayRandomHadith();
        });
    </script>
</body>
</html>
